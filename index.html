<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Famille Connect Pro - Version Compl√®te</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #4a5568;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.2rem;
            color: #718096;
        }

        .setup-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .setup-area.hidden {
            display: none;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .menu-card:hover::before {
            left: 100%;
        }

        .menu-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }

        .menu-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.05);
        }

        .menu-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            display: block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .menu-card h3 {
            font-size: 1.6rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .menu-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-area.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-header h2 {
            font-size: 2rem;
            color: #4a5568;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .btn.danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .btn.warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        /* Photo Upload System */
        .photo-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(102, 126, 234, 0.1);
            margin: 15px 0;
        }

        .photo-upload-area:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }

        .photo-upload-area input {
            display: none;
        }

        .profile-photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #667eea;
            margin: 10px auto;
            display: block;
            background: #f0f0f0;
        }

        /* Chat System */
        .chat-container {
            background: #f7fafc;
            border-radius: 15px;
            padding: 0;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
            background: #f1f5f9;
            border-left: 4px solid #667eea;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .message.own {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-left: none;
            border-right: 4px solid #4c51bf;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            flex: 1;
        }

        .message .sender {
            font-weight: bold;
            font-size: 0.85rem;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .message .timestamp {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 5px;
        }

        .chat-input {
            padding: 20px;
            background: #f7fafc;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input input:focus {
            border-color: #667eea;
        }

        /* Video Conference System */
        .video-conference {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .video-item {
            position: relative;
            background: #333;
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        .video-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .video-control-btn {
            background: rgba(0,0,0,0.7);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .video-control-btn:hover {
            background: rgba(0,0,0,0.9);
            transform: scale(1.1);
        }

        .video-control-btn.active {
            background: #e53e3e;
        }

        .video-status {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        /* Family Members with Photos */
        .family-members {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .member-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .member-card:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .member-avatar {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid rgba(255,255,255,0.5);
            overflow: hidden;
            position: relative;
        }

        .member-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .member-avatar .add-photo-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Photo Gallery */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .photo-item {
            background: linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%);
            aspect-ratio: 1;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.4s ease;
            overflow: hidden;
            position: relative;
        }

        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
        }

        /* Games System Enhanced */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .game-card {
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .game-card span {
            display: block;
            margin-bottom: 15px;
        }

        .game-card .difficulty {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.3);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .game-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        /* Memory Game Enhanced */
        .memory-grid {
            display: grid;
            gap: 15px;
            justify-content: center;
            margin: 20px auto;
            max-width: 800px;
        }

        .memory-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }

        .memory-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .memory-card.flipped {
            background: linear-gradient(135deg, #48bb78, #38a169);
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            opacity: 0.7;
            cursor: default;
        }

        .memory-card img {
            width: 80%;
            height: 80%;
            object-fit: cover;
            border-radius: 10px;
        }

        /* Drawing Canvas Enhanced */
        #drawingCanvas {
            border: 3px solid #667eea;
            border-radius: 15px;
            background: white;
            cursor: crosshair;
            display: block;
            margin: 20px auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .drawing-tools {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-btn:hover {
            transform: scale(1.1);
            border-color: #667eea;
        }

        .color-btn.active {
            border-color: #667eea;
            transform: scale(1.2);
        }

        .brush-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid #e2e8f0;
        }

        /* Statistics */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            color: white;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            max-width: 400px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.show {
            display: block;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            animation: modalZoom 0.3s ease-out;
        }

        @keyframes modalZoom {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* Game Timer */
        .game-timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 999;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-menu {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .menu-icon {
                font-size: 2.5rem;
            }

            .section-header {
                flex-direction: column;
                text-align: center;
            }

            .content-area {
                padding: 20px;
            }

            .video-grid {
                grid-template-columns: 1fr;
            }

            .memory-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .drawing-tools {
                gap: 10px;
            }

            .color-btn {
                width: 30px;
                height: 30px;
            }
        }

        @media (max-width: 480px) {
            .memory-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .memory-card {
                font-size: 1.5rem;
                min-height: 60px;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 999;
            display: none;
        }

        .connection-status.show {
            display: block;
        }

        .connection-status.online {
            background: #48bb78;
        }

        .connection-status.offline {
            background: #e53e3e;
        }

        /* Game Score Display */
        .game-score {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
        }

        /* Word Game Input */
        .word-input {
            text-align: center;
            font-size: 1.3rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 15px 20px;
            border: 3px solid #667eea;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 300px;
            display: block;
        }

        /* Pictionary Word Display */
        .pictionary-word {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            letter-spacing: 3px;
        }

        /* Quiz Question */
        .quiz-question {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.2rem;
            text-align: center;
            border-left: 5px solid #667eea;
        }

        .quiz-options {
            display: grid;
            gap: 15px;
            max-width: 500px;
            margin: 20px auto;
        }

        .quiz-option {
            padding: 15px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f0f9ff;
            transform: translateY(-2px);
        }

        .quiz-option.correct {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
        }

        .quiz-option.incorrect {
            background: #e53e3e;
            color: white;
            border-color: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="appTitle">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille Connect Pro</h1>
            <p id="appSubtitle">L'application familiale compl√®te avec photos et jeux renouvelables</p>
        </div>

        <!-- Configuration Setup -->
        <div id="setupArea" class="setup-area">
            <h2 class="text-center mb-20">üöÄ Configuration Familiale</h2>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 25%;"></div>
            </div>
            <p id="progressText" class="text-center mb-20">Personnalisez votre famille...</p>

            <div class="form-group">
                <label for="familyName">Nom de votre famille :</label>
                <input type="text" id="familyName" placeholder="Ex: Les Dupont, Famille Martin...">
            </div>

            <div class="form-group">
                <label for="familyMotto">Devise familiale (optionnel) :</label>
                <input type="text" id="familyMotto" placeholder="Ex: Ensemble, toujours plus forts !">
            </div>

            <div class="text-center mt-20">
                <button class="btn" onclick="finishQuickSetup()">üéØ Commencer l'aventure !</button>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" style="display: none;">
            <div class="main-menu">
                <div class="menu-card" onclick="showSection('chat')">
                    <span class="menu-icon">üí¨</span>
                    <h3>Chat Familial</h3>
                    <p>Messages avec photos</p>
                </div>
                
                <div class="menu-card" onclick="showSection('family')">
                    <span class="menu-icon">üë•</span>
                    <h3>Ma Famille</h3>
                    <p>Photos de profil</p>
                </div>
                
                <div class="menu-card" onclick="showSection('photos')">
                    <span class="menu-icon">üì∏</span>
                    <h3>Galerie</h3>
                    <p>Albums partag√©s</p>
                </div>
                
                <div class="menu-card" onclick="showSection('calls')">
                    <span class="menu-icon">üìπ</span>
                    <h3>Appels Vid√©o</h3>
                    <p>Visio int√©gr√©e</p>
                </div>
                
                <div class="menu-card" onclick="showSection('games')">
                    <span class="menu-icon">üéÆ</span>
                    <h3>10 Jeux</h3>
                    <p>Contenu renouvelable</p>
                </div>
                
                <div class="menu-card" onclick="showSection('settings')">
                    <span class="menu-icon">‚öôÔ∏è</span>
                    <h3>Param√®tres</h3>
                    <p>Sauvegarde & config</p>
                </div>
            </div>

            <!-- Chat Section with Photo Support -->
            <div id="chat" class="content-area">
                <div class="section-header">
                    <h2>üí¨ Chat Familial</h2>
                    <div>
                        <button class="btn secondary" onclick="clearChat()">üóëÔ∏è Effacer</button>
                        <button class="btn" onclick="addQuickMessage()">‚ö° Message rapide</button>
                    </div>
                </div>
                
                <div class="chat-container">
                    <div class="chat-header">
                        <span>üí¨ Conversation familiale</span>
                        <span id="onlineMembers">üë• 3 en ligne</span>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        <div class="message">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-content">
                                <div class="sender">Syst√®me</div>
                                <div>Bienvenue dans votre chat familial avec support photos ! üéâ</div>
                                <div class="timestamp">Maintenant</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input">
                        <input type="text" id="messageInput" placeholder="Tapez votre message..." onkeypress="handleChatKeyPress(event)">
                        <button class="btn secondary" onclick="addPhotoToChat()">üì∑</button>
                        <button class="btn" onclick="sendChatMessage()">üì§</button>
                    </div>
                </div>
            </div>

            <!-- Family Section with Photo Management -->
            <div id="family" class="content-area">
                <div class="section-header">
                    <h2>üë• Ma Famille</h2>
                    <button class="btn" onclick="addFamilyMember()">‚ûï Ajouter membre</button>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMembers">4</div>
                        <div>Membres</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="onlineNow">3</div>
                        <div>En ligne</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalMessages">0</div>
                        <div>Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="photosWithProfiles">0</div>
                        <div>Photos ajout√©es</div>
                    </div>
                </div>
                
                <div class="family-members" id="familyMembersList">
                    <!-- Members will be loaded here -->
                </div>
            </div>

            <!-- Photos Section Enhanced -->
            <div id="photos" class="content-area">
                <div class="section-header">
                    <h2>üì∏ Galerie Familiale</h2>
                    <button class="btn" onclick="uploadPhotos()">üì§ Ajouter photos</button>
                </div>
                
                <div class="photo-gallery" id="photoGallery">
                    <!-- Photos will be loaded here -->
                </div>
                
                <input type="file" id="photoInput" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(event)">
            </div>

            <!-- Video Calls Section -->
            <div id="calls" class="content-area">
                <div class="section-header">
                    <h2>üìπ Appels Vid√©o</h2>
                    <div>
                        <button class="btn" onclick="startVideoCall()" id="startCallBtn">üìû D√©marrer</button>
                        <button class="btn danger" onclick="endVideoCall()" id="endCallBtn" style="display: none;">üìû Terminer</button>
                    </div>
                </div>
                
                <div class="video-conference" id="videoConference">
                    <div class="video-grid" id="videoGrid">
                        <div class="video-item" id="localVideoContainer">
                            <video id="localVideo" autoplay muted></video>
                            <div class="video-status">üë§ Vous</div>
                            <div class="video-controls">
                                <button class="video-control-btn" onclick="toggleMicrophone()" id="micBtn">üé§</button>
                                <button class="video-control-btn" onclick="toggleCamera()" id="cameraBtn">üìπ</button>
                                <button class="video-control-btn" onclick="shareScreen()" id="screenBtn">üñ•Ô∏è</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <p id="callStatus">Pr√™t pour un appel</p>
                        <p id="participantsList"></p>
                    </div>
                </div>
            </div>

            <!-- Enhanced Games Section with 10 Games -->
            <div id="games" class="content-area">
                <div class="section-header">
                    <h2>üéÆ Centre de Jeux (10 Jeux)</h2>
                    <div>
                        <button class="btn secondary" onclick="refreshAllGames()">üîÑ Renouveler</button>
                        <button class="btn" onclick="randomGame()">üé≤ Jeu surprise</button>
                    </div>
                </div>
                
                <div class="games-grid">
                    <div class="game-card" onclick="startMemoryGame()" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                        <span style="font-size: 3rem;">üß†</span>
                        <h3>M√©moire +</h3>
                        <p>Photos renouvelables</p>
                        <div class="difficulty">Niveau <span id="memoryLevel">1</span>/5</div>
                    </div>
                    
                    <div class="game-card" onclick="startQuizGame()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                        <span style="font-size: 3rem;">‚ùì</span>
                        <h3>Quiz G√©n√©ral</h3>
                        <p>Culture g√©n√©rale</p>
                        <div class="difficulty">Facile</div>
                    </div>
                    
                    <div class="game-card" onclick="startFamilyQuiz()" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);">
                        <span style="font-size: 3rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <h3>Quiz Familial</h3>
                        <p>Sur votre famille</p>
                        <div class="difficulty">Personnel</div>
                    </div>
                    
                    <div class="game-card" onclick="startPictionaryGame()" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                        <span style="font-size: 3rem;">üé®</span>
                        <h3>Pictionary</h3>
                        <p>Dessinez et devinez</p>
                        <div class="difficulty">Cr√©atif</div>
                    </div>
                    
                    <div class="game-card" onclick="startWordGame()" style="background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);">
                        <span style="font-size: 3rem;">üìù</span>
                        <h3>Mots M√©lang√©s</h3>
                        <p>Th√®mes renouvelables</p>
                        <div class="difficulty">Moyen</div>
                    </div>
                    
                    <div class="game-card" onclick="startEmojiGame()" style="background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);">
                        <span style="font-size: 3rem;">üòä</span>
                        <h3>Devinettes Emoji</h3>
                        <p>Trouvez les mots</p>
                        <div class="difficulty">Amusant</div>
                    </div>
                    
                    <div class="game-card" onclick="startMathGame()" style="background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);">
                        <span style="font-size: 3rem;">üî¢</span>
                        <h3>Calcul Rapide</h3>
                        <p>D√©fis math√©matiques</p>
                        <div class="difficulty">Niveau <span id="mathLevel">1</span>/3</div>
                    </div>
                    
                    <div class="game-card" onclick="startColorGame()" style="background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);">
                        <span style="font-size: 3rem;">üåà</span>
                        <h3>Couleurs</h3>
                        <p>Rapidit√© et pr√©cision</p>
                        <div class="difficulty">Rapide</div>
                    </div>
                    
                    <div class="game-card" onclick="startStoryGame()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <span style="font-size: 3rem;">üìö</span>
                        <h3>Histoire Collective</h3>
                        <p>Cr√©ez ensemble</p>
                        <div class="difficulty">Collaboratif</div>
                    </div>
                    
                    <div class="game-card" onclick="startReactionGame()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <span style="font-size: 3rem;">‚ö°</span>
                        <h3>R√©flexes</h3>
                        <p>Testez votre vitesse</p>
                        <div class="difficulty">Intensif</div>
                    </div>
                </div>

                <!-- Game Area -->
                <div id="gameArea" class="game-area" style="display: none;">
                    <div id="gameContent"></div>
                    <div class="text-center mt-20">
                        <button class="btn danger" onclick="closeGame()">üö™ Quitter</button>
                    </div>
                </div>
            </div>

            <!-- Settings Section Enhanced -->
            <div id="settings" class="content-area">
                <div class="section-header">
                    <h2>‚öôÔ∏è Param√®tres</h2>
                    <div>
                        <button class="btn" onclick="exportAllData()">üíæ Sauvegarder</button>
                        <button class="btn secondary" onclick="importAllData()">üì§ Charger</button>
                    </div>
                </div>
                
                <!-- Statut de sauvegarde -->
                <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                    <p id="saveStatus" style="margin: 0; font-weight: 600; opacity: 0.7;">üÜï Session active</p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">
                        üí° Utilisez "Sauvegarder" pour t√©l√©charger vos donn√©es
                    </p>
                </div>
                
                <div class="form-group">
                    <label for="settingsFamilyName">Nom de famille :</label>
                    <input type="text" id="settingsFamilyName" placeholder="Nom de famille">
                </div>
                
                <div class="form-group">
                    <label for="settingsMotto">Devise familiale :</label>
                    <input type="text" id="settingsMotto" placeholder="Devise familiale">
                </div>
                
                <div class="text-center mt-20">
                    <button class="btn" onclick="saveSettings()">üíæ Sauvegarder param√®tres</button>
                    <button class="btn warning" onclick="resetApp()">üîÑ R√©initialiser</button>
                </div>
                
                <!-- Informations sur la session -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h4>üìä Statistiques de session</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;" id="sessionMembers">4</div>
                            <div style="font-size: 0.9rem; color: #666;">Membres</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #48bb78;" id="sessionMessages">0</div>
                            <div style="font-size: 0.9rem; color: #666;">Messages</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #ed8936;" id="sessionPhotos">0</div>
                            <div style="font-size: 0.9rem; color: #666;">Photos</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #9f7aea;" id="gamesPlayed">0</div>
                            <div style="font-size: 0.9rem; color: #666;">Jeux jou√©s</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Member Modal with Photo Upload -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <h3>üë• Membre de la famille</h3>
            
            <div class="form-group">
                <label>Photo de profil :</label>
                <div class="photo-upload-area" onclick="document.getElementById('memberPhotoInput').click()">
                    <input type="file" id="memberPhotoInput" accept="image/*" onchange="previewMemberPhoto(event)">
                    <img id="memberPhotoPreview" class="profile-photo-preview" style="display: none;">
                    <div id="photoUploadText">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üì∑</div>
                        <p>Cliquez pour ajouter une photo</p>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="memberName">Nom :</label>
                <input type="text" id="memberName" placeholder="Nom du membre">
            </div>
            
            <div class="form-group">
                <label for="memberRole">R√¥le :</label>
                <select id="memberRole">
                    <option value="parent">Parent</option>
                    <option value="enfant">Enfant</option>
                    <option value="grand-parent">Grand-parent</option>
                    <option value="frere-soeur">Fr√®re/S≈ìur</option>
                    <option value="ami">Ami de la famille</option>
                    <option value="autre">Autre</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="memberEmoji">Emoji (si pas de photo) :</label>
                <input type="text" id="memberEmoji" placeholder="üòä" maxlength="2">
            </div>
            
            <div class="text-center mt-20">
                <button class="btn" onclick="saveMember()">üíæ Sauvegarder</button>
                <button class="btn secondary" onclick="closeMemberModal()">‚ùå Annuler</button>
            </div>
        </div>
    </div>

    <!-- Game Timer -->
    <div id="gameTimer" class="game-timer" style="display: none;">
        ‚è±Ô∏è <span id="timerDisplay">00:00</span>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status">
        <span id="connectionText">üü¢ En ligne</span>
    </div>

    <script>
        // Enhanced Application State
        let appState = {
            familyInfo: {
                name: 'Ma Famille',
                motto: 'Ensemble, toujours plus forts !'
            },
            members: [
                { id: 1, name: 'Papa', role: 'parent', emoji: 'üë®', online: true, messages: 15, photo: null },
                { id: 2, name: 'Maman', role: 'parent', emoji: 'üë©', online: true, messages: 23, photo: null },
                { id: 3, name: 'Sophie', role: 'enfant', emoji: 'üëß', online: false, messages: 8, photo: null },
                { id: 4, name: 'Lucas', role: 'enfant', emoji: 'üë¶', online: true, messages: 12, photo: null }
            ],
            photos: [],
            messages: [],
            currentUser: 'Moi',
            isConfigured: false,
            gameData: {
                memoryLevel: 1,
                mathLevel: 1,
                gamesPlayed: 0,
                totalScore: 0
            },
            videoCall: {
                active: false,
                localStream: null,
                participants: [],
                micMuted: false,
                videoMuted: false
            }
        };

        // Enhanced Game Content with Renewal System
        const gameContent = {
            memory: {
                levels: [
                    { pairs: 4, grid: '4x2', items: ['üçé', 'üçä', 'üçå', 'üçá'] },
                    { pairs: 6, grid: '4x3', items: ['üê∂', 'üê±', 'üê∞', 'ü¶ä', 'üê∏', 'üêß'] },
                    { pairs: 8, grid: '4x4', items: ['‚öΩ', 'üèÄ', 'üéæ', 'üèê', 'üèà', '‚öæ', 'üé±', 'üèì'] },
                    { pairs: 10, grid: '5x4', items: ['üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèéÔ∏è', 'üöì', 'üöë', 'üö≤', 'üõµ'] },
                    { pairs: 12, grid: '6x4', items: ['üå∏', 'üå∫', 'üåª', 'üåπ', 'üå∑', 'üíê', 'üåº', 'üèµÔ∏è', 'üåø', 'üçÄ', 'üå±', 'üåæ'] }
                ],
                currentLevel: 0
            },
            quiz: {
                general: [
                    { q: "Quelle est la capitale de la France ?", options: ["Lyon", "Marseille", "Paris", "Toulouse"], correct: 2 },
                    { q: "Combien font 7 x 8 ?", options: ["54", "56", "58", "60"], correct: 1 },
                    { q: "Quel est l'animal le plus rapide ?", options: ["Gu√©pard", "Lion", "Antilope", "Faucon"], correct: 0 },
                    { q: "En quelle ann√©e l'homme a-t-il march√© sur la Lune ?", options: ["1967", "1969", "1971", "1973"], correct: 1 },
                    { q: "Quelle est la plus grande plan√®te du syst√®me solaire ?", options: ["Saturne", "Jupiter", "Neptune", "Uranus"], correct: 1 }
                ]
            },
            words: [
                { theme: "Famille", words: ["FAMILLE", "AMOUR", "BONHEUR", "SOURIRE", "TENDRESSE", "PARTAGE"] },
                { theme: "Vacances", words: ["VACANCES", "PLAGE", "SOLEIL", "DETENTE", "VOYAGE", "AVENTURE"] },
                { theme: "No√´l", words: ["NOEL", "CADEAU", "SAPIN", "MAGIE", "FETE", "TRADITION"] },
                { theme: "Cuisine", words: ["CUISINE", "REPAS", "PARTAGE", "SAVEUR", "DELICIEUX", "RECETTE"] },
                { theme: "Nature", words: ["NATURE", "FLEUR", "ARBRE", "MONTAGNE", "RIVIERE", "FORET"] }
            ],
            emoji: [
                { question: "üè†üîë", answer: "MAISON", hint: "Lieu o√π on habite" },
                { question: "üöó‚õΩ", answer: "VOITURE", hint: "Moyen de transport" },
                { question: "üçïüßÄ", answer: "PIZZA", hint: "Plat italien" },
                { question: "üìö‚úèÔ∏è", answer: "ECOLE", hint: "Lieu d'apprentissage" },
                { question: "‚òÄÔ∏èüèñÔ∏è", answer: "VACANCES", hint: "P√©riode de repos" },
                { question: "üéÇüéâ", answer: "ANNIVERSAIRE", hint: "F√™te annuelle" },
                { question: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶‚ù§Ô∏è", answer: "FAMILLE", hint: "Nos proches" },
                { question: "üåô‚≠ê", answer: "NUIT", hint: "Oppos√© du jour" }
            ],
            pictionary: [
                { word: "MAISON", category: "Objet", difficulty: "Facile" },
                { word: "VOITURE", category: "Transport", difficulty: "Facile" },
                { word: "SOLEIL", category: "Nature", difficulty: "Facile" },
                { word: "ORDINATEUR", category: "Technologie", difficulty: "Moyen" },
                { word: "ANNIVERSAIRE", category: "√âv√©nement", difficulty: "Moyen" },
                { word: "PARAPLUIE", category: "Objet", difficulty: "Moyen" },
                { word: "PHOTOGRAPHIE", category: "Art", difficulty: "Difficile" },
                { word: "ARCHITECTURE", category: "Art", difficulty: "Difficile" }
            ],
            math: [
                // Niveau 1
                [
                    { question: "5 + 3 = ?", answer: 8 },
                    { question: "10 - 4 = ?", answer: 6 },
                    { question: "7 √ó 2 = ?", answer: 14 },
                    { question: "15 √∑ 3 = ?", answer: 5 }
                ],
                // Niveau 2  
                [
                    { question: "12 √ó 8 = ?", answer: 96 },
                    { question: "144 √∑ 12 = ?", answer: 12 },
                    { question: "15 + 27 = ?", answer: 42 },
                    { question: "100 - 37 = ?", answer: 63 }
                ],
                // Niveau 3
                [
                    { question: "25¬≤ = ?", answer: 625 },
                    { question: "‚àö169 = ?", answer: 13 },
                    { question: "17 √ó 23 = ?", answer: 391 },
                    { question: "1000 √∑ 25 = ?", answer: 40 }
                ]
            ],
            colors: ["rouge", "bleu", "vert", "jaune", "orange", "violet", "rose", "noir", "blanc", "gris"],
            reaction: {
                instructions: [
                    "Cliquez quand vous voyez le cercle VERT !",
                    "Appuyez sur ESPACE quand l'√©cran devient BLEU !",
                    "Cliquez le plus vite possible quand √ßa clignote !",
                    "Attendez le signal sonore, puis cliquez !"
                ]
            }
        };

        // Enhanced member management with photos
        let currentMemberPhoto = null;
        let editingMemberId = null;

        // Peer-to-peer connection for video calls
        let peerConnections = new Map();
        let localStream = null;
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        // Game timers and intervals
        let gameTimer = null;
        let gameStartTime = null;

        // Initialize app
        window.addEventListener('DOMContentLoaded', function() {
            const dataLoaded = loadAppData();
            initializeApp();
            updateAllStats();
            
            if (dataLoaded) {
                showNotification('üîÑ Session restaur√©e avec photos !', 'success');
            } else {
                showNotification('üéâ Bienvenue dans Famille Connect Pro !', 'success');
            }
            
            setTimeout(() => {
                showNotification('üí° Ajoutez des photos de profil pour une meilleure reconnaissance !', 'info', 5000);
            }, 3000);
        });

        // Quick setup
        function finishQuickSetup() {
            const familyName = document.getElementById('familyName').value.trim();
            const familyMotto = document.getElementById('familyMotto').value.trim();
            
            if (familyName) {
                appState.familyInfo.name = familyName;
                appState.familyInfo.motto = familyMotto || 'Ensemble, toujours plus forts !';
                appState.isConfigured = true;
                
                document.getElementById('setupArea').classList.add('hidden');
                document.getElementById('mainApp').style.display = 'block';
                
                updateAppTitle();
                updateAllStats();
                renderFamilyMembers();
                saveAppData();
                
                showNotification('‚úÖ Configuration termin√©e ! Ajoutez des photos de profil.', 'success');
            } else {
                showNotification('‚ö†Ô∏è Veuillez entrer un nom de famille', 'warning');
            }
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.content-area').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.menu-card').forEach(card => {
                card.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.closest('.menu-card').classList.add('active');
            
            switch(sectionId) {
                case 'family':
                    renderFamilyMembers();
                    break;
                case 'photos':
                    renderPhotoGallery();
                    break;
                case 'chat':
                    renderChatMessages();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'games':
                    updateGameLevels();
                    break;
            }
        }

        // Enhanced Chat System with Photos
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                const currentMember = appState.members.find(m => m.name === appState.currentUser) || appState.members[0];
                
                const newMessage = {
                    id: Date.now(),
                    sender: appState.currentUser,
                    text: message,
                    timestamp: new Date(),
                    own: true,
                    avatar: currentMember.photo,
                    emoji: currentMember.emoji
                };
                
                appState.messages.push(newMessage);
                renderChatMessages();
                input.value = '';
                
                setTimeout(simulateResponse, 1000 + Math.random() * 2000);
                saveAppData();
            }
        }

        function simulateResponse() {
            const responses = [
                "C'est une excellente id√©e ! üòä",
                "Je suis d'accord avec toi üëç",
                "Merci pour ce message ! ‚ù§Ô∏è",
                "Haha, tr√®s dr√¥le ! üòÇ",
                "On en parle ce soir ! üí≠",
                "Super ! üéâ",
                "Bonne id√©e ! üí°",
                "Je t'aime aussi ! ‚ù§Ô∏è"
            ];
            
            const randomMember = appState.members[Math.floor(Math.random() * appState.members.length)];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const responseMessage = {
                id: Date.now(),
                sender: randomMember.name,
                text: randomResponse,
                timestamp: new Date(),
                emoji: randomMember.emoji,
                avatar: randomMember.photo,
                own: false
            };
            
            appState.messages.push(responseMessage);
            renderChatMessages();
            
            randomMember.messages++;
            updateAllStats();
            saveAppData();
        }

        function renderChatMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            
            // Message de bienvenue syst√®me
            if (appState.messages.length === 0) {
                const welcomeMessage = document.createElement('div');
                welcomeMessage.className = 'message';
                welcomeMessage.innerHTML = `
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <div class="sender">Syst√®me</div>
                        <div>Bienvenue dans votre chat familial avec support photos ! üéâ</div>
                        <div class="timestamp">Maintenant</div>
                    </div>
                `;
                container.appendChild(welcomeMessage);
            }
            
            appState.messages.slice(-50).forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.own ? 'own' : ''}`;
                
                const timeStr = message.timestamp.toLocaleTimeString('fr-FR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const avatarContent = message.avatar ? 
                    `<img src="${message.avatar}" alt="${message.sender}">` : 
                    (message.emoji || 'üë§');
                
                messageDiv.innerHTML = `
                    <div class="message-avatar">${avatarContent}</div>
                    <div class="message-content">
                        <div class="sender">${message.sender}</div>
                        <div>${message.text}</div>
                        <div class="timestamp">${timeStr}</div>
                    </div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            container.scrollTop = container.scrollHeight;
        }

        function addPhotoToChat() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const currentMember = appState.members.find(m => m.name === appState.currentUser) || appState.members[0];
                        
                        const photoMessage = {
                            id: Date.now(),
                            sender: appState.currentUser,
                            text: `üì∑ ${file.name}`,
                            timestamp: new Date(),
                            own: true,
                            avatar: currentMember.photo,
                            emoji: currentMember.emoji,
                            image: e.target.result
                        };
                        
                        appState.messages.push(photoMessage);
                        renderChatMessages();
                        showNotification('üì∑ Photo ajout√©e au chat !', 'success');
                        saveAppData();
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function clearChat() {
            if (confirm('Effacer tous les messages ?')) {
                appState.messages = [];
                renderChatMessages();
                showNotification('üóëÔ∏è Messages effac√©s', 'info');
                saveAppData();
            }
        }

        function addQuickMessage() {
            const quickMessages = [
                "Salut tout le monde ! üëã",
                "Comment √ßa va ? üòä",
                "Qui veut jouer ? üéÆ",
                "Bonne journ√©e ! ‚òÄÔ∏è",
                "Je vous aime ! ‚ù§Ô∏è",
                "Qu'est-ce qu'on mange ? üçΩÔ∏è",
                "Belle photo ! üì∏",
                "√Ä ce soir ! üåô"
            ];
            
            const randomMessage = quickMessages[Math.floor(Math.random() * quickMessages.length)];
            document.getElementById('messageInput').value = randomMessage;
            sendChatMessage();
        }

        // Enhanced Family Management with Photos
        function addFamilyMember() {
            editingMemberId = null;
            currentMemberPhoto = null;
            
            document.getElementById('memberName').value = '';
            document.getElementById('memberRole').value = 'parent';
            document.getElementById('memberEmoji').value = 'üòä';
            document.getElementById('memberPhotoPreview').style.display = 'none';
            document.getElementById('photoUploadText').style.display = 'block';
            document.getElementById('memberModal').classList.add('show');
        }

        function editFamilyMember(memberId) {
            const member = appState.members.find(m => m.id === memberId);
            if (!member) return;
            
            editingMemberId = memberId;
            currentMemberPhoto = member.photo;
            
            document.getElementById('memberName').value = member.name;
            document.getElementById('memberRole').value = member.role;
            document.getElementById('memberEmoji').value = member.emoji || 'üòä';
            
            if (member.photo) {
                document.getElementById('memberPhotoPreview').src = member.photo;
                document.getElementById('memberPhotoPreview').style.display = 'block';
                document.getElementById('photoUploadText').style.display = 'none';
            } else {
                document.getElementById('memberPhotoPreview').style.display = 'none';
                document.getElementById('photoUploadText').style.display = 'block';
            }
            
            document.getElementById('memberModal').classList.add('show');
        }

        function previewMemberPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentMemberPhoto = e.target.result;
                    document.getElementById('memberPhotoPreview').src = e.target.result;
                    document.getElementById('memberPhotoPreview').style.display = 'block';
                    document.getElementById('photoUploadText').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function saveMember() {
            const name = document.getElementById('memberName').value.trim();
            const role = document.getElementById('memberRole').value;
            const emoji = document.getElementById('memberEmoji').value || 'üòä';
            
            if (name) {
                if (editingMemberId) {
                    // Edit existing member
                    const member = appState.members.find(m => m.id === editingMemberId);
                    if (member) {
                        member.name = name;
                        member.role = role;
                        member.emoji = emoji;
                        member.photo = currentMemberPhoto;
                        showNotification(`‚úÖ ${name} modifi√© avec succ√®s !`, 'success');
                    }
                } else {
                    // Add new member
                    const newMember = {
                        id: Date.now(),
                        name: name,
                        role: role,
                        emoji: emoji,
                        photo: currentMemberPhoto,
                        online: Math.random() > 0.5,
                        messages: 0
                    };
                    
                    appState.members.push(newMember);
                    showNotification(`‚úÖ ${name} ajout√© √† la famille !`, 'success');
                }
                
                renderFamilyMembers();
                updateAllStats();
                closeMemberModal();
                saveAppData();
            } else {
                showNotification('‚ö†Ô∏è Veuillez entrer un nom', 'warning');
            }
        }

        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('show');
            currentMemberPhoto = null;
            editingMemberId = null;
        }

        function renderFamilyMembers() {
            const container = document.getElementById('familyMembersList');
            container.innerHTML = '';
            
            appState.members.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = 'member-card';
                memberCard.onclick = () => editFamilyMember(member.id);
                
                const avatarContent = member.photo ? 
                    `<img src="${member.photo}" alt="${member.name}">` : 
                    member.emoji;
                
                memberCard.innerHTML = `
                    <div class="member-avatar">
                        ${avatarContent}
                        <button class="add-photo-btn" onclick="event.stopPropagation(); editFamilyMember(${member.id})">üì∑</button>
                    </div>
                    <h3>${member.name}</h3>
                    <p>${member.role}</p>
                    <p>${member.online ? 'üü¢ En ligne' : '‚ö™ Hors ligne'}</p>
                    <p>Messages: ${member.messages}</p>
                `;
                container.appendChild(memberCard);
            });
        }

        // Enhanced Photo Management
        function uploadPhotos() {
            document.getElementById('photoInput').click();
        }

        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            let uploadedCount = 0;
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const newPhoto = {
                            id: Date.now() + uploadedCount,
                            src: e.target.result,
                            name: file.name,
                            uploadDate: new Date(),
                            uploadedBy: appState.currentUser
                        };
                        
                        appState.photos.push(newPhoto);
                        renderPhotoGallery();
                        updateAllStats();
                        saveAppData();
                        uploadedCount++;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            if (files.length > 0) {
                showNotification(`üì∏ ${files.length} photo(s) ajout√©e(s) !`, 'success');
            }
        }

        function renderPhotoGallery() {
            const container = document.getElementById('photoGallery');
            container.innerHTML = '';
            
            // Add upload button
            const uploadCard = document.createElement('div');
            uploadCard.className = 'photo-item';
            uploadCard.onclick = uploadPhotos;
            uploadCard.innerHTML = `
                <div style="font-size: 3rem;">üì§</div>
                <div>Ajouter photos</div>
            `;
            container.appendChild(uploadCard);
            
            // Add photos
            appState.photos.forEach(photo => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-item';
                photoCard.innerHTML = `<img src="${photo.src}" alt="${photo.name}">`;
                photoCard.onclick = () => viewPhoto(photo);
                container.appendChild(photoCard);
            });
        }

        function viewPhoto(photo) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <h3>üì∏ ${photo.name}</h3>
                    <img src="${photo.src}" style="width: 100%; max-height: 500px; object-fit: contain; border-radius: 10px; margin: 20px 0;">
                    <p>Ajout√©e le ${photo.uploadDate.toLocaleDateString()} par ${photo.uploadedBy || 'Inconnu'}</p>
                    <button class="btn" onclick="this.closest('.modal').remove()">‚ùå Fermer</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Enhanced Games System with 10 Games
        function updateGameLevels() {
            document.getElementById('memoryLevel').textContent = appState.gameData.memoryLevel;
            document.getElementById('mathLevel').textContent = appState.gameData.mathLevel;
        }

        function refreshAllGames() {
            // M√©langer tous les contenus de jeux
            gameContent.memory.levels.forEach(level => {
                level.items = shuffleArray(level.items);
            });
            
            gameContent.quiz.general = shuffleArray(gameContent.quiz.general);
            gameContent.words = shuffleArray(gameContent.words);
            gameContent.emoji = shuffleArray(gameContent.emoji);
            gameContent.pictionary = shuffleArray(gameContent.pictionary);
            gameContent.colors = shuffleArray(gameContent.colors);
            
            updateGameLevels();
            showNotification('üéÆ Tous les jeux ont √©t√© renouvel√©s !', 'success');
        }

        function randomGame() {
            const games = [
                'startMemoryGame', 'startQuizGame', 'startFamilyQuiz', 'startPictionaryGame',
                'startWordGame', 'startEmojiGame', 'startMathGame', 'startColorGame',
                'startStoryGame', 'startReactionGame'
            ];
            
            const randomGameFunction = games[Math.floor(Math.random() * games.length)];
            eval(randomGameFunction + '()');
            showNotification('üé≤ Jeu surprise s√©lectionn√© !', 'info');
        }

        // Game 1: Enhanced Memory Game with Photos
        function startMemoryGame() {
            const level = gameContent.memory.levels[appState.gameData.memoryLevel - 1];
            const cards = [...level.items, ...level.items];
            const shuffledCards = shuffleArray(cards);
            
            appState.currentGame = {
                type: 'memory',
                cards: shuffledCards,
                flipped: [],
                matched: [],
                attempts: 0,
                startTime: Date.now(),
                level: appState.gameData.memoryLevel
            };
            
            showGameArea();
            renderMemoryGame();
            startGameTimer();
        }

        function renderMemoryGame() {
            const gridSize = Math.ceil(Math.sqrt(appState.currentGame.cards.length));
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üß† Jeu de M√©moire - Niveau ${appState.currentGame.level}</h3>
                <div class="game-score">
                    Essais: ${appState.currentGame.attempts} | 
                    Paires: ${appState.currentGame.matched.length / 2}/${appState.currentGame.cards.length / 2} |
                    Temps: <span id="memoryTime">00:00</span>
                </div>
                <div class="memory-grid" style="grid-template-columns: repeat(${gridSize}, 1fr);" id="memoryGrid"></div>
                <div class="text-center mt-20">
                    <button class="btn secondary" onclick="restartMemoryGame()">üîÑ Recommencer</button>
                    <button class="btn warning" onclick="changeMemoryLevel()">‚öôÔ∏è Changer niveau</button>
                </div>
            `;
            
            const grid = document.getElementById('memoryGrid');
            appState.currentGame.cards.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                
                if (appState.currentGame.flipped.includes(index) || appState.currentGame.matched.includes(index)) {
                    if (item.startsWith('http') || item.startsWith('data:')) {
                        card.innerHTML = `<img src="${item}" alt="carte">`;
                    } else {
                        card.textContent = item;
                    }
                } else {
                    card.textContent = '?';
                }
                
                if (appState.currentGame.matched.includes(index)) {
                    card.classList.add('matched');
                }
                
                card.onclick = () => flipMemoryCard(index);
                grid.appendChild(card);
            });
        }

        function flipMemoryCard(index) {
            if (appState.currentGame.flipped.length < 2 && 
                !appState.currentGame.flipped.includes(index) && 
                !appState.currentGame.matched.includes(index)) {
                
                appState.currentGame.flipped.push(index);
                renderMemoryGame();
                
                if (appState.currentGame.flipped.length === 2) {
                    appState.currentGame.attempts++;
                    setTimeout(checkMemoryMatch, 1000);
                }
            }
        }

        function checkMemoryMatch() {
            const [first, second] = appState.currentGame.flipped;
            
            if (appState.currentGame.cards[first] === appState.currentGame.cards[second]) {
                appState.currentGame.matched.push(first, second);
                showNotification('‚úÖ Bonne paire !', 'success');
                
                if (appState.currentGame.matched.length === appState.currentGame.cards.length) {
                    stopGameTimer();
                    const timeElapsed = Math.floor((Date.now() - appState.currentGame.startTime) / 1000);
                    const score = Math.max(1000 - appState.currentGame.attempts * 50 - timeElapsed * 5, 100);
                    
                    appState.gameData.totalScore += score;
                    appState.gameData.gamesPlayed++;
                    
                    showNotification(`üéâ Niveau ${appState.currentGame.level} r√©ussi ! Score: ${score}`, 'success');
                    
                    // Proposer le niveau suivant
                    if (appState.gameData.memoryLevel < 5) {
                        setTimeout(() => {
                            if (confirm('üöÄ Passer au niveau suivant ?')) {
                                appState.gameData.memoryLevel++;
                                startMemoryGame();
                            }
                        }, 2000);
                    }
                }
            }
            
            appState.currentGame.flipped = [];
            renderMemoryGame();
        }

        function restartMemoryGame() {
            startMemoryGame();
        }

        function changeMemoryLevel() {
            const level = prompt(`Choisir le niveau (1-5) :`);
            if (level && !isNaN(level)) {
                const newLevel = parseInt(level);
                if (newLevel >= 1 && newLevel <= 5) {
                    appState.gameData.memoryLevel = newLevel;
                    startMemoryGame();
                    showNotification(`‚úÖ Niveau ${newLevel} s√©lectionn√© !`, 'success');
                }
            }
        }

        // Game 2: General Quiz
        function startQuizGame() {
            const questions = shuffleArray([...gameContent.quiz.general]);
            
            appState.currentGame = {
                type: 'quiz',
                questions: questions.slice(0, 5),
                current: 0,
                score: 0,
                startTime: Date.now()
            };
            
            showGameArea();
            renderQuizGame();
            startGameTimer();
        }

        function renderQuizGame() {
            if (appState.currentGame.current >= appState.currentGame.questions.length) {
                stopGameTimer();
                const score = (appState.currentGame.score / appState.currentGame.questions.length) * 100;
                appState.gameData.totalScore += appState.currentGame.score * 100;
                appState.gameData.gamesPlayed++;
                
                document.getElementById('gameContent').innerHTML = `
                    <div class="text-center">
                        <h3>üéâ Quiz termin√© !</h3>
                        <div class="game-score">
                            Score: ${appState.currentGame.score}/${appState.currentGame.questions.length} (${Math.round(score)}%)
                        </div>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            ${score >= 80 ? 'üèÜ Excellent !' : score >= 60 ? 'üëç Bien jou√© !' : score >= 40 ? 'üòä Pas mal !' : 'ü§î Il faut r√©viser !'}
                        </p>
                        <button class="btn" onclick="startQuizGame()">üîÑ Nouveau quiz</button>
                    </div>
                `;
                updateAllStats();
                return;
            }
            
            const question = appState.currentGame.questions[appState.currentGame.current];
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">‚ùì Quiz G√©n√©ral</h3>
                <div class="game-score">
                    Question ${appState.currentGame.current + 1}/${appState.currentGame.questions.length} | 
                    Score: ${appState.currentGame.score}/${appState.currentGame.questions.length}
                </div>
                <div class="quiz-question">${question.q}</div>
                <div class="quiz-options" id="quizOptions"></div>
            `;
            
            const optionsDiv = document.getElementById('quizOptions');
            question.options.forEach((option, index) => {
                const button = document.createElement('div');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => answerQuiz(index, question.correct);
                optionsDiv.appendChild(button);
            });
        }

        function answerQuiz(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.quiz-option');
            
            if (selectedIndex === correctIndex) {
                appState.currentGame.score++;
                options[selectedIndex].classList.add('correct');
                showNotification('‚úÖ Bonne r√©ponse !', 'success');
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
                showNotification('‚ùå Mauvaise r√©ponse', 'error');
            }
            
            options.forEach(option => option.onclick = null);
            
            appState.currentGame.current++;
            setTimeout(renderQuizGame, 2000);
        }

        // Game 3: Family Quiz (Auto-generated)
        function startFamilyQuiz() {
            const familyQuestions = generateFamilyQuestions();
            
            appState.currentGame = {
                type: 'familyQuiz',
                questions: familyQuestions,
                current: 0,
                score: 0,
                startTime: Date.now()
            };
            
            showGameArea();
            renderFamilyQuiz();
            startGameTimer();
        }

        function generateFamilyQuestions() {
            const questions = [];
            
            // Question sur le nombre de membres
            questions.push({
                q: `Combien y a-t-il de membres dans ${appState.familyInfo.name} ?`,
                options: [
                    (appState.members.length - 1).toString(),
                    appState.members.length.toString(),
                    (appState.members.length + 1).toString(),
                    (appState.members.length + 2).toString()
                ],
                correct: 1
            });
            
            // Question sur un membre al√©atoire
            if (appState.members.length > 0) {
                const randomMember = appState.members[Math.floor(Math.random() * appState.members.length)];
                const otherMembers = appState.members.filter(m => m !== randomMember);
                const options = [randomMember.name];
                
                // Ajouter de fausses options
                while (options.length < 4) {
                    if (otherMembers.length > 0) {
                        const otherMember = otherMembers.pop();
                        options.push(otherMember.name);
                    } else {
                        options.push('Inconnu');
                    }
                }
                
                questions.push({
                    q: `Quel est le r√¥le de ${randomMember.name} dans la famille ?`,
                    options: shuffleArray(['parent', 'enfant', 'grand-parent', randomMember.role]),
                    correct: shuffleArray(['parent', 'enfant', 'grand-parent', randomMember.role]).indexOf(randomMember.role)
                });
            }
            
            // Question sur la devise
            if (appState.familyInfo.motto && appState.familyInfo.motto !== 'Ensemble, toujours plus forts !') {
                questions.push({
                    q: `Quelle est la devise de ${appState.familyInfo.name} ?`,
                    options: [
                        appState.familyInfo.motto,
                        "Ensemble nous sommes forts",
                        "L'amour avant tout",
                        "Unis pour la vie"
                    ],
                    correct: 0
                });
            }
            
            // Questions g√©n√©rales sur la famille
            questions.push({
                q: "Quelle est la chose la plus importante dans une famille ?",
                options: ["L'argent", "L'amour", "La maison", "La voiture"],
                correct: 1
            });
            
            return questions.slice(0, 5);
        }

        function renderFamilyQuiz() {
            if (appState.currentGame.current >= appState.currentGame.questions.length) {
                stopGameTimer();
                const score = (appState.currentGame.score / appState.currentGame.questions.length) * 100;
                appState.gameData.gamesPlayed++;
                
                document.getElementById('gameContent').innerHTML = `
                    <div class="text-center">
                        <h3>üéâ Quiz Familial termin√© !</h3>
                        <div class="game-score">
                            Score: ${appState.currentGame.score}/${appState.currentGame.questions.length} (${Math.round(score)}%)
                        </div>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            ${score >= 80 ? 'üèÜ Vous connaissez bien votre famille !' : 'üòä Pas mal, mais vous pouvez mieux faire !'}
                        </p>
                        <button class="btn" onclick="startFamilyQuiz()">üîÑ Nouveau quiz familial</button>
                    </div>
                `;
                updateAllStats();
                return;
            }
            
            const question = appState.currentGame.questions[appState.currentGame.current];
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Quiz Familial</h3>
                <div class="game-score">
                    Question ${appState.currentGame.current + 1}/${appState.currentGame.questions.length} | 
                    Score: ${appState.currentGame.score}/${appState.currentGame.questions.length}
                </div>
                <div class="quiz-question">${question.q}</div>
                <div class="quiz-options" id="familyQuizOptions"></div>
            `;
            
            const optionsDiv = document.getElementById('familyQuizOptions');
            question.options.forEach((option, index) => {
                const button = document.createElement('div');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => answerFamilyQuiz(index, question.correct);
                optionsDiv.appendChild(button);
            });
        }

        function answerFamilyQuiz(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.quiz-option');
            
            if (selectedIndex === correctIndex) {
                appState.currentGame.score++;
                options[selectedIndex].classList.add('correct');
                showNotification('‚úÖ Excellent ! Vous connaissez bien votre famille !', 'success');
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
                showNotification('‚ùå Pas tout √† fait...', 'error');
            }
            
            options.forEach(option => option.onclick = null);
            
            appState.currentGame.current++;
            setTimeout(renderFamilyQuiz, 2000);
        }

        // Game 4: Enhanced Pictionary
        function startPictionaryGame() {
            const words = shuffleArray([...gameContent.pictionary]);
            const selectedWord = words[0];
            
            appState.currentGame = {
                type: 'pictionary',
                word: selectedWord.word,
                category: selectedWord.category,
                difficulty: selectedWord.difficulty,
                timeLeft: 120,
                startTime: Date.now(),
                currentColor: '#000000',
                brushSize: 3
            };
            
            showGameArea();
            renderPictionaryGame();
            startPictionaryTimer();
        }

        function renderPictionaryGame() {
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üé® Pictionary</h3>
                <div class="pictionary-word">
                    MOT √Ä DESSINER: ${appState.currentGame.word}
                    <br><small>Cat√©gorie: ${appState.currentGame.category} ‚Ä¢ ${appState.currentGame.difficulty}</small>
                </div>
                <div class="game-score">
                    ‚è∞ Temps restant: <span id="pictionaryTimer">${appState.currentGame.timeLeft}s</span>
                </div>
                
                <canvas id="drawingCanvas" width="600" height="400"></canvas>
                
                <div class="drawing-tools">
                    <div class="brush-size-control">
                        <label>Taille: </label>
                        <input type="range" id="brushSize" min="1" max="20" value="3" onchange="updateBrushSize()">
                        <span id="brushSizeDisplay">3px</span>
                    </div>
                </div>
                
                <div class="drawing-tools">
                    <div class="color-btn" style="background: #000000;" onclick="changeColor('#000000')"></div>
                    <div class="color-btn" style="background: #ff0000;" onclick="changeColor('#ff0000')"></div>
                    <div class="color-btn" style="background: #00ff00;" onclick="changeColor('#00ff00')"></div>
                    <div class="color-btn" style="background: #0000ff;" onclick="changeColor('#0000ff')"></div>
                    <div class="color-btn" style="background: #ffff00;" onclick="changeColor('#ffff00')"></div>
                    <div class="color-btn" style="background: #ff00ff;" onclick="changeColor('#ff00ff')"></div>
                    <div class="color-btn" style="background: #00ffff;" onclick="changeColor('#00ffff')"></div>
                    <div class="color-btn" style="background: #ffa500;" onclick="changeColor('#ffa500')"></div>
                </div>
                
                <div class="text-center mt-20">
                    <button class="btn secondary" onclick="clearDrawing()">üóëÔ∏è Effacer</button>
                    <button class="btn" onclick="saveDrawingToGallery()">üíæ Sauvegarder</button>
                    <button class="btn warning" onclick="startPictionaryGame()">üé≤ Nouveau mot</button>
                </div>
            `;
            
            initializeDrawingCanvas();
            updateColorButtons();
        }

        function initializeDrawingCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // Configuration du contexte
            ctx.strokeStyle = appState.currentGame.currentColor;
            ctx.lineWidth = appState.currentGame.brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // √âv√©nements souris
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // √âv√©nements tactiles
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                
                ctx.lineWidth = appState.currentGame.brushSize;
                ctx.strokeStyle = appState.currentGame.currentColor;
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
                ctx.beginPath();
            }
            
            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                 e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        function changeColor(color) {
            appState.currentGame.currentColor = color;
            updateColorButtons();
        }

        function updateColorButtons() {
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.style.backgroundColor === appState.currentGame.currentColor) {
                    btn.classList.add('active');
                }
            });
        }

        function updateBrushSize() {
            appState.currentGame.brushSize = document.getElementById('brushSize').value;
            document.getElementById('brushSizeDisplay').textContent = appState.currentGame.brushSize + 'px';
        }

        function clearDrawing() {
            const canvas = document.getElementById('drawingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function saveDrawingToGallery() {
            const canvas = document.getElementById('drawingCanvas');
            const imageData = canvas.toDataURL();
            
            const newPhoto = {
                id: Date.now(),
                src: imageData,
                name: `Dessin_Pictionary_${appState.currentGame.word}_${new Date().toLocaleDateString()}`,
                uploadDate: new Date(),
                uploadedBy: appState.currentUser,
                category: 'Dessins'
            };
            
            appState.photos.push(newPhoto);
            updateAllStats();
            saveAppData();
            
            showNotification('üé® Dessin sauvegard√© dans la galerie !', 'success');
        }

        function startPictionaryTimer() {
            const timer = setInterval(() => {
                appState.currentGame.timeLeft--;
                const timerElement = document.getElementById('pictionaryTimer');
                if (timerElement) {
                    timerElement.textContent = appState.currentGame.timeLeft + 's';
                    
                    if (appState.currentGame.timeLeft <= 30) {
                        timerElement.style.color = '#e53e3e';
                        timerElement.style.fontWeight = 'bold';
                    }
                }
                
                if (appState.currentGame.timeLeft <= 0) {
                    clearInterval(timer);
                    showNotification('‚è∞ Temps √©coul√© ! Le mot √©tait: ' + appState.currentGame.word, 'info');
                    appState.gameData.gamesPlayed++;
                    updateAllStats();
                }
            }, 1000);
            
            appState.currentGame.timer = timer;
        }

        // Game 5: Enhanced Word Game
        function startWordGame() {
            const themes = shuffleArray([...gameContent.words]);
            const selectedTheme = themes[0];
            const randomWord = selectedTheme.words[Math.floor(Math.random() * selectedTheme.words.length)];
            const scrambledWord = scrambleWord(randomWord);
            
            appState.currentGame = {
                type: 'word',
                word: randomWord,
                scrambled: scrambledWord,
                theme: selectedTheme.theme,
                attempts: 0,
                hints: 0,
                maxHints: 3,
                startTime: Date.now()
            };
            
            showGameArea();
            renderWordGame();
            startGameTimer();
        }

        function scrambleWord(word) {
            return word.split('').sort(() => Math.random() - 0.5).join('');
        }

        function renderWordGame() {
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üìù Mots M√©lang√©s</h3>
                <div class="game-score">
                    Th√®me: <strong>${appState.currentGame.theme}</strong> | 
                    Essais: ${appState.currentGame.attempts} | 
                    Indices: ${appState.currentGame.hints}/${appState.currentGame.maxHints}
                </div>
                
                <div style="font-size: 2.5rem; text-align: center; margin: 30px 0; letter-spacing: 8px; background: #f0f0f0; padding: 25px; border-radius: 15px; border: 3px dashed #667eea;">
                    ${appState.currentGame.scrambled}
                </div>
                
                <div class="text-center">
                    <input type="text" id="wordGuess" class="word-input" placeholder="VOTRE R√âPONSE..." maxlength="${appState.currentGame.word.length}">
                    <div class="mt-20">
                        <button class="btn" onclick="checkWordGuess()">‚úÖ V√©rifier</button>
                        <button class="btn secondary" onclick="giveWordHint()">üí° Indice</button>
                        <button class="btn warning" onclick="startWordGame()">üé≤ Nouveau mot</button>
                    </div>
                    <div id="wordResult" class="mt-20" style="font-size: 1.2rem; font-weight: bold;"></div>
                    <div id="wordHint" class="mt-20" style="font-style: italic; color: #666;"></div>
                </div>
            `;
            
            document.getElementById('wordGuess').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkWordGuess();
            });
            document.getElementById('wordGuess').focus();
        }

        function checkWordGuess() {
            const guess = document.getElementById('wordGuess').value.trim().toUpperCase();
            const correct = appState.currentGame.word.toUpperCase();
            const result = document.getElementById('wordResult');
            
            appState.currentGame.attempts++;
            
            if (guess === correct) {
                stopGameTimer();
                const timeElapsed = Math.floor((Date.now() - appState.currentGame.startTime) / 1000);
                const score = Math.max(1000 - appState.currentGame.attempts * 100 - timeElapsed * 2, 100);
                
                result.innerHTML = `üéâ Bravo ! "${correct}" trouv√© en ${appState.currentGame.attempts} essai(s) ! Score: ${score}`;
                result.style.color = 'green';
                
                appState.gameData.totalScore += score;
                appState.gameData.gamesPlayed++;
                updateAllStats();
                
                setTimeout(() => {
                    if (confirm('üéä F√©licitations ! Jouer un autre mot ?')) {
                        startWordGame();
                    }
                }, 2000);
            } else if (guess.length === 0) {
                result.innerHTML = '‚ö†Ô∏è Tapez votre r√©ponse !';
                result.style.color = 'orange';
            } else {
                result.innerHTML = `‚ùå "${guess}" n'est pas correct... Essayez encore ! (${appState.currentGame.attempts} essais)`;
                result.style.color = 'red';
                
                if (appState.currentGame.attempts >= 5) {
                    result.innerHTML += `<br>üí° Le mot √©tait: <strong>${correct}</strong>`;
                    setTimeout(() => {
                        if (confirm('Mot suivant ?')) startWordGame();
                    }, 3000);
                }
            }
            
            renderWordGame();
        }

        function giveWordHint() {
            if (appState.currentGame.hints >= appState.currentGame.maxHints) {
                showNotification('‚ùå Plus d\'indices disponibles !', 'warning');
                return;
            }
            
            appState.currentGame.hints++;
            const word = appState.currentGame.word;
            const hintDiv = document.getElementById('wordHint');
            
            if (appState.currentGame.hints === 1) {
                hintDiv.innerHTML = `üí° Indice 1: Le mot contient ${word.length} lettres et commence par "${word[0]}"`;
            } else if (appState.currentGame.hints === 2) {
                const midChar = word[Math.floor(word.length / 2)];
                hintDiv.innerHTML += `<br>üí° Indice 2: La lettre du milieu est "${midChar}"`;
            } else if (appState.currentGame.hints === 3) {
                const lastChar = word[word.length - 1];
                hintDiv.innerHTML += `<br>üí° Indice 3: Se termine par "${lastChar}"`;
            }
        }

        // Game 6: Emoji Game
        function startEmojiGame() {
            const questions = shuffleArray([...gameContent.emoji]);
            
            appState.currentGame = {
                type: 'emoji',
                questions: questions.slice(0, 5),
                current: 0,
                score: 0,
                attempts: 0,
                startTime: Date.now()
            };
            
            showGameArea();
            renderEmojiGame();
            startGameTimer();
        }

        function renderEmojiGame() {
            if (appState.currentGame.current >= appState.currentGame.questions.length) {
                stopGameTimer();
                const score = (appState.currentGame.score / appState.currentGame.questions.length) * 100;
                appState.gameData.totalScore += appState.currentGame.score * 150;
                appState.gameData.gamesPlayed++;
                
                document.getElementById('gameContent').innerHTML = `
                    <div class="text-center">
                        <h3>üéâ Devinettes Emoji termin√©es !</h3>
                        <div class="game-score">
                            Score final: ${appState.currentGame.score}/${appState.currentGame.questions.length} (${Math.round(score)}%)
                        </div>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            ${score >= 80 ? 'üèÜ Ma√Ætre des emojis !' : score >= 60 ? 'üòä Bien jou√© !' : 'ü§î Encore un effort !'}
                        </p>
                        <button class="btn" onclick="startEmojiGame()">üîÑ Nouveaux emojis</button>
                    </div>
                `;
                updateAllStats();
                return;
            }
            
            const question = appState.currentGame.questions[appState.currentGame.current];
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üòä Devinettes Emoji</h3>
                <div class="game-score">
                    Question ${appState.currentGame.current + 1}/${appState.currentGame.questions.length} | 
                    Score: ${appState.currentGame.score} | 
                    Essais: ${appState.currentGame.attempts}
                </div>
                
                <div style="font-size: 4rem; text-align: center; margin: 40px 0; padding: 30px; background: #f8f9fa; border-radius: 20px;">
                    ${question.question}
                </div>
                
                <p style="text-align: center; font-style: italic; color: #666; margin: 20px 0; font-size: 1.1rem;">
                    üí° ${question.hint}
                </p>
                
                <div class="text-center">
                    <input type="text" id="emojiAnswer" class="word-input" placeholder="VOTRE R√âPONSE..." style="max-width: 400px;">
                    <div class="mt-20">
                        <button class="btn" onclick="checkEmojiAnswer()">‚úÖ V√©rifier</button>
                        <button class="btn secondary" onclick="skipEmojiQuestion()">‚è≠Ô∏è Passer</button>
                    </div>
                    <div id="emojiResult" class="mt-20" style="font-size: 1.2rem; font-weight: bold;"></div>
                </div>
            `;
            
            document.getElementById('emojiAnswer').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkEmojiAnswer();
            });
            document.getElementById('emojiAnswer').focus();
        }

        function checkEmojiAnswer() {
            const input = document.getElementById('emojiAnswer');
            const guess = input.value.trim().toUpperCase();
            const question = appState.currentGame.questions[appState.currentGame.current];
            const result = document.getElementById('emojiResult');
            
            appState.currentGame.attempts++;
            
            if (guess === question.answer) {
                appState.currentGame.score++;
                result.innerHTML = 'üéâ Excellent ! Bonne r√©ponse !';
                result.style.color = 'green';
                showNotification('‚úÖ Bonne r√©ponse !', 'success');
                setTimeout(nextEmojiQuestion, 2000);
            } else if (guess.length === 0) {
                result.innerHTML = '‚ö†Ô∏è Tapez votre r√©ponse !';
                result.style.color = 'orange';
            } else {
                result.innerHTML = `‚ùå Pas tout √† fait... Essayez encore !`;
                result.style.color = 'red';
                
                if (appState.currentGame.attempts >= 3) {
                    result.innerHTML = `üí° La r√©ponse √©tait: <strong>${question.answer}</strong>`;
                    setTimeout(nextEmojiQuestion, 3000);
                }
            }
        }

        function skipEmojiQuestion() {
            nextEmojiQuestion();
        }

        function nextEmojiQuestion() {
            appState.currentGame.current++;
            appState.currentGame.attempts = 0;
            renderEmojiGame();
        }

        // Game 7: Math Game
        function startMathGame() {
            const level = appState.gameData.mathLevel - 1;
            const questions = shuffleArray([...gameContent.math[level]]);
            
            appState.currentGame = {
                type: 'math',
                questions: questions.slice(0, 8),
                current: 0,
                score: 0,
                level: appState.gameData.mathLevel,
                startTime: Date.now(),
                timePerQuestion: 15
            };
            
            showGameArea();
            renderMathGame();
            startMathTimer();
        }

        function renderMathGame() {
            if (appState.currentGame.current >= appState.currentGame.questions.length) {
                stopGameTimer();
                const score = (appState.currentGame.score / appState.currentGame.questions.length) * 100;
                appState.gameData.totalScore += appState.currentGame.score * 200;
                appState.gameData.gamesPlayed++;
                
                document.getElementById('gameContent').innerHTML = `
                    <div class="text-center">
                        <h3>üéâ Calcul Rapide termin√© !</h3>
                        <div class="game-score">
                            Niveau ${appState.currentGame.level} | Score: ${appState.currentGame.score}/${appState.currentGame.questions.length} (${Math.round(score)}%)
                        </div>
                        <p style="font-size: 1.2rem; margin: 20px 0;">
                            ${score >= 80 ? 'üèÜ G√©nie des maths !' : score >= 60 ? 'üßÆ Bien calcul√© !' : 'üìö Il faut r√©viser !'}
                        </p>
                        <button class="btn" onclick="startMathGame()">üîÑ Recommencer</button>
                        ${appState.gameData.mathLevel < 3 ? '<button class="btn secondary" onclick="nextMathLevel()">‚¨ÜÔ∏è Niveau suivant</button>' : ''}
                    </div>
                `;
                updateAllStats();
                return;
            }
            
            const question = appState.currentGame.questions[appState.currentGame.current];
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üî¢ Calcul Rapide - Niveau ${appState.currentGame.level}</h3>
                <div class="game-score">
                    Question ${appState.currentGame.current + 1}/${appState.currentGame.questions.length} | 
                    Score: ${appState.currentGame.score} | 
                    Temps: <span id="mathTimer">${appState.currentGame.timePerQuestion}s</span>
                </div>
                
                <div style="font-size: 3rem; text-align: center; margin: 40px 0; padding: 30px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px;">
                    ${question.question}
                </div>
                
                <div class="text-center">
                    <input type="number" id="mathAnswer" class="word-input" placeholder="?" style="max-width: 200px; text-align: center;">
                    <div class="mt-20">
                        <button class="btn" onclick="checkMathAnswer()">‚úÖ R√©pondre</button>
                        <button class="btn secondary" onclick="skipMathQuestion()">‚è≠Ô∏è Passer</button>
                    </div>
                    <div id="mathResult" class="mt-20" style="font-size: 1.2rem; font-weight: bold;"></div>
                </div>
            `;
            
            document.getElementById('mathAnswer').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkMathAnswer();
            });
            document.getElementById('mathAnswer').focus();
        }

        function startMathTimer() {
            let timeLeft = appState.currentGame.timePerQuestion;
            
            const timer = setInterval(() => {
                timeLeft--;
                const timerElement = document.getElementById('mathTimer');
                if (timerElement) {
                    timerElement.textContent = timeLeft + 's';
                    
                    if (timeLeft <= 5) {
                        timerElement.style.color = '#e53e3e';
                        timerElement.style.fontWeight = 'bold';
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    skipMathQuestion();
                }
            }, 1000);
            
            appState.currentGame.mathTimer = timer;
        }

        function checkMathAnswer() {
            const answer = parseInt(document.getElementById('mathAnswer').value);
            const question = appState.currentGame.questions[appState.currentGame.current];
            const result = document.getElementById('mathResult');
            
            if (appState.currentGame.mathTimer) {
                clearInterval(appState.currentGame.mathTimer);
            }
            
            if (answer === question.answer) {
                appState.currentGame.score++;
                result.innerHTML = 'üéâ Exact ! Bonne r√©ponse !';
                result.style.color = 'green';
                showNotification('‚úÖ Correct !', 'success');
            } else {
                result.innerHTML = `‚ùå Incorrect. La r√©ponse √©tait: ${question.answer}`;
                result.style.color = 'red';
            }
            
            appState.currentGame.current++;
            setTimeout(renderMathGame, 2000);
        }

        function skipMathQuestion() {
            if (appState.currentGame.mathTimer) {
                clearInterval(appState.currentGame.mathTimer);
            }
            
            const result = document.getElementById('mathResult');
            if (result) {
                const question = appState.currentGame.questions[appState.currentGame.current];
                result.innerHTML = `‚è∞ Temps √©coul√© ! R√©ponse: ${question.answer}`;
                result.style.color = 'orange';
            }
            
            appState.currentGame.current++;
            setTimeout(renderMathGame, 2000);
        }

        function nextMathLevel() {
            if (appState.gameData.mathLevel < 3) {
                appState.gameData.mathLevel++;
                startMathGame();
                showNotification(`üìà Niveau ${appState.gameData.mathLevel} !`, 'success');
            }
        }

        // Game 8: Color Game
        function startColorGame() {
            appState.currentGame = {
                type: 'color',
                score: 0,
                level: 1,
                timeLeft: 60,
                currentColorWord: '',
                currentColorDisplay: '',
                correctAnswers: 0,
                startTime: Date.now()
            };
            
            showGameArea();
            generateColorQuestion();
            startColorTimer();
        }

        function generateColorQuestion() {
            const colors = shuffleArray([...gameContent.colors]);
            const colorWord = colors[0];
            const displayColor = colors[1];
            
            appState.currentGame.currentColorWord = colorWord;
            appState.currentGame.currentColorDisplay = displayColor;
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üåà Test de Couleurs</h3>
                <div class="game-score">
                    Score: ${appState.currentGame.score} | 
                    Niveau: ${appState.currentGame.level} | 
                    Temps: <span id="colorTimer">${appState.currentGame.timeLeft}s</span>
                </div>
                
                <div style="text-align: center; margin: 40px 0;">
                    <p style="font-size: 1.5rem; margin-bottom: 20px;">Quelle est la COULEUR du mot (pas ce qu'il dit) :</p>
                    <div style="font-size: 4rem; font-weight: bold; color: ${getColorCode(displayColor)}; margin: 30px 0;">
                        ${colorWord.toUpperCase()}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 500px; margin: 0 auto;">
                    ${gameContent.colors.slice(0, 6).map(color => 
                        `<button class="btn" onclick="answerColor('${color}')" style="background: ${getColorCode(color)}; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">${color}</button>`
                    ).join('')}
                </div>
                
                <div id="colorResult" class="text-center mt-20" style="font-size: 1.2rem; font-weight: bold;"></div>
            `;
        }

        function getColorCode(colorName) {
            const colorCodes = {
                'rouge': '#ff0000',
                'bleu': '#0000ff', 
                'vert': '#00ff00',
                'jaune': '#ffff00',
                'orange': '#ffa500',
                'violet': '#8a2be2',
                'rose': '#ffc0cb',
                'noir': '#000000',
                'blanc': '#ffffff',
                'gris': '#808080'
            };
            return colorCodes[colorName] || '#000000';
        }

        function answerColor(selectedColor) {
            const result = document.getElementById('colorResult');
            
            if (selectedColor === appState.currentGame.currentColorDisplay) {
                appState.currentGame.score += appState.currentGame.level * 10;
                appState.currentGame.correctAnswers++;
                result.innerHTML = '‚úÖ Correct !';
                result.style.color = 'green';
                showNotification('+' + (appState.currentGame.level * 10) + ' points !', 'success');
                
                // Augmenter la difficult√©
                if (appState.currentGame.correctAnswers % 5 === 0) {
                    appState.currentGame.level++;
                    showNotification(`üéä Niveau ${appState.currentGame.level} !`, 'info');
                }
            } else {
                result.innerHTML = `‚ùå Incorrect ! C'√©tait ${appState.currentGame.currentColorDisplay}`;
                result.style.color = 'red';
            }
            
            setTimeout(generateColorQuestion, 1500);
        }

        function startColorTimer() {
            const timer = setInterval(() => {
                appState.currentGame.timeLeft--;
                const timerElement = document.getElementById('colorTimer');
                if (timerElement) {
                    timerElement.textContent = appState.currentGame.timeLeft + 's';
                    
                    if (appState.currentGame.timeLeft <= 10) {
                        timerElement.style.color = '#e53e3e';
                    }
                }
                
                if (appState.currentGame.timeLeft <= 0) {
                    clearInterval(timer);
                    endColorGame();
                }
            }, 1000);
            
            appState.currentGame.colorTimer = timer;
        }

        function endColorGame() {
            appState.gameData.totalScore += appState.currentGame.score;
            appState.gameData.gamesPlayed++;
            
            document.getElementById('gameContent').innerHTML = `
                <div class="text-center">
                    <h3>üéâ Test de Couleurs termin√© !</h3>
                    <div class="game-score">
                        Score final: ${appState.currentGame.score} points<br>
                        Niveau atteint: ${appState.currentGame.level}<br>
                        Bonnes r√©ponses: ${appState.currentGame.correctAnswers}
                    </div>
                    <p style="font-size: 1.2rem; margin: 20px 0;">
                        ${appState.currentGame.score >= 500 ? 'üèÜ Ma√Ætre des couleurs !' : 
                          appState.currentGame.score >= 200 ? 'üåà Excellent ≈ìil !' : 'üëÄ Bon entra√Ænement !'}
                    </p>
                    <button class="btn" onclick="startColorGame()">üîÑ Rejouer</button>
                </div>
            `;
            updateAllStats();
        }

        // Game 9: Story Game
        function startStoryGame() {
            appState.currentGame = {
                type: 'story',
                story: "Il √©tait une fois, dans une famille aimante et unie...",
                contributors: [],
                currentTurn: 0,
                startTime: Date.now()
            };
            
            showGameArea();
            renderStoryGame();
        }

        function renderStoryGame() {
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">üìö Histoire Collective Familiale</h3>
                <p class="text-center mb-20">Cr√©ez une histoire ensemble, chacun ajoute une phrase !</p>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 20px 0; min-height: 200px; text-align: left; font-size: 1.1rem; line-height: 1.6; border: 2px solid #e2e8f0;">
                    <div id="storyText">${appState.currentGame.story}</div>
                </div>
                
                <div style="margin: 20px 0;">
                    <select id="storyContributor" style="padding: 12px; margin-right: 10px; border-radius: 8px; border: 2px solid #e2e8f0; font-size: 1rem;">
                        <option value="">Qui ajoute la suite ?</option>
                        ${appState.members.map(member => 
                            `<option value="${member.name}">${member.emoji} ${member.name}</option>`
                        ).join('')}
                    </select>
                </div>
                
                <textarea id="storyInput" placeholder="Ajoutez la suite de l'histoire (une ou deux phrases)..." 
                    style="width: 100%; height: 100px; padding: 15px; font-size: 1.1rem; border-radius: 10px; border: 2px solid #e2e8f0; margin: 10px 0; resize: vertical; font-family: inherit;"></textarea>
                
                <div class="text-center">
                    <button class="btn" onclick="addToStory()">‚ûï Ajouter √† l'histoire</button>
                    <button class="btn secondary" onclick="saveStory()">üíæ Sauvegarder</button>
                    <button class="btn warning" onclick="startStoryGame()">üîÑ Nouvelle histoire</button>
                </div>
                
                <div id="storyContributors" style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px; font-size: 0.9rem; color: #666;">
                    ${appState.currentGame.contributors.length > 0 ? 
                        'Contributions: ' + appState.currentGame.contributors.map(c => c.name).join(', ') : 
                        'Soyez le premier √† contribuer !'}
                </div>
            `;
        }

        function addToStory() {
            const input = document.getElementById('storyInput');
            const contributor = document.getElementById('storyContributor');
            const newSentence = input.value.trim();
            const contributorName = contributor.value;
            
            if (newSentence && contributorName) {
                appState.currentGame.story += ` ${newSentence}`;
                appState.currentGame.contributors.push({
                    name: contributorName, 
                    sentence: newSentence,
                    timestamp: new Date()
                });
                
                document.getElementById('storyText').textContent = appState.currentGame.story;
                document.getElementById('storyContributors').innerHTML = 
                    'Contributions: ' + appState.currentGame.contributors.map(c => `${c.name}`).join(', ');
                
                input.value = '';
                contributor.value = '';
                
                appState.gameData.gamesPlayed++;
                updateAllStats();
                saveAppData();
                
                showNotification(`üìù ${contributorName} a ajout√© √† l'histoire !`, 'success');
            } else {
                showNotification('‚ö†Ô∏è Choisissez un contributeur et tapez du texte !', 'warning');
            }
        }

        function saveStory() {
            const story = `HISTOIRE FAMILIALE CR√â√âE LE ${new Date().toLocaleDateString()}\n\n${appState.currentGame.story}\n\n--- CONTRIBUTEURS ---\n${appState.currentGame.contributors.map(c => `${c.name}: "${c.sentence}"`).join('\n')}`;
            
            const blob = new Blob([story], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `histoire-familiale-${new Date().toLocaleDateString()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üíæ Histoire sauvegard√©e !', 'success');
        }

        // Game 10: Reaction Game
        function startReactionGame() {
            appState.currentGame = {
                type: 'reaction',
                phase: 'instructions',
                score: 0,
                round: 1,
                maxRounds: 5,
                reactionTimes: [],
                startTime: Date.now(),
                waitingForReaction: false
            };
            
            showGameArea();
            showReactionInstructions();
        }

        function showReactionInstructions() {
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">‚ö° Test de R√©flexes</h3>
                <div class="game-score">
                    Round ${appState.currentGame.round}/${appState.currentGame.maxRounds} | 
                    Score moyen: ${appState.currentGame.reactionTimes.length > 0 ? 
                        Math.round(appState.currentGame.reactionTimes.reduce((a, b) => a + b, 0) / appState.currentGame.reactionTimes.length) + 'ms' : 
                        '---'}
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 20px; margin: 30px 0; text-align: center;">
                    <h4 style="margin-bottom: 20px;">Instructions</h4>
                    <p style="font-size: 1.2rem; line-height: 1.6;">
                        Cliquez le plus vite possible quand l'√©cran devient <strong style="color: #90EE90;">VERT</strong> !<br>
                        Attention : ne cliquez pas trop t√¥t !
                    </p>
                </div>
                
                <div class="text-center">
                    <button class="btn" onclick="startReactionRound()" style="font-size: 1.3rem; padding: 20px 40px;">üöÄ Commencer le round ${appState.currentGame.round}</button>
                </div>
                
                ${appState.currentGame.reactionTimes.length > 0 ? `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-top: 30px;">
                        <h4>üìä Vos temps de r√©action :</h4>
                        <div style="display: flex; justify-content: space-around; margin-top: 15px; flex-wrap: wrap;">
                            ${appState.currentGame.reactionTimes.map((time, index) => 
                                `<div style="text-align: center; margin: 10px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: ${time < 300 ? '#48bb78' : time < 500 ? '#ed8936' : '#e53e3e'};">${time}ms</div>
                                    <div style="font-size: 0.9rem; color: #666;">Round ${index + 1}</div>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function startReactionRound() {
            const waitTime = 2000 + Math.random() * 4000; // 2-6 secondes
            
            document.getElementById('gameContent').innerHTML = `
                <h3 class="text-center mb-20">‚ö° Test de R√©flexes - Round ${appState.currentGame.round}</h3>
                
                <div id="reactionArea" onclick="handleReactionClick()" style="
                    width: 100%; 
                    height: 400px; 
                    background: #e53e3e; 
                    border-radius: 20px; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    font-size: 2rem; 
                    color: white; 
                    cursor: pointer;
                    user-select: none;
                    transition: all 0.3s ease;
                ">
                    <div>
                        <div style="font-size: 3rem; margin-bottom: 20px;">‚è≥</div>
                        <div>Attendez le signal...</div>
                        <div style="font-size: 1.2rem; margin-top: 10px; opacity: 0.8;">Ne cliquez pas encore !</div>
                    </div>
                </div>
                
                <div class="text-center mt-20">
                    <button class="btn danger" onclick="cancelReactionRound()">‚ùå Annuler</button>
                </div>
            `;
            
            appState.currentGame.waitingForReaction = false;
            appState.currentGame.tooEarly = false;
            
            setTimeout(() => {
                const reactionArea = document.getElementById('reactionArea');
                if (reactionArea && !appState.currentGame.tooEarly) {
                    reactionArea.style.background = '#48bb78';
                    reactionArea.innerHTML = `
                        <div>
                            <div style="font-size: 3rem; margin-bottom: 20px;">‚ö°</div>
                            <div>CLIQUEZ MAINTENANT !</div>
                        </div>
                    `;
                    appState.currentGame.reactionStartTime = Date.now();
                    appState.currentGame.waitingForReaction = true;
                }
            }, waitTime);
        }

        function handleReactionClick() {
            if (appState.currentGame.waitingForReaction) {
                // Bonne r√©action
                const reactionTime = Date.now() - appState.currentGame.reactionStartTime;
                appState.currentGame.reactionTimes.push(reactionTime);
                
                let message = '';
                let color = '';
                if (reactionTime < 200) {
                    message = 'üèÜ INCROYABLE ! R√©flexes de ninja !';
                    color = '#48bb78';
                } else if (reactionTime < 300) {
                    message = 'üéØ Excellent ! Tr√®s rapide !';
                    color = '#48bb78';
                } else if (reactionTime < 500) {
                    message = 'üëç Bien jou√© ! Bons r√©flexes !';
                    color = '#ed8936';
                } else {
                    message = 'üòÖ Pas mal, mais on peut faire mieux !';
                    color = '#e53e3e';
                }
                
                document.getElementById('reactionArea').innerHTML = `
                    <div style="color: white;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">‚ö°</div>
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">${reactionTime}ms</div>
                        <div>${message}</div>
                    </div>
                `;
                
                appState.currentGame.waitingForReaction = false;
                appState.currentGame.round++;
                
                setTimeout(() => {
                    if (appState.currentGame.round <= appState.currentGame.maxRounds) {
                        showReactionInstructions();
                    } else {
                        showReactionResults();
                    }
                }, 3000);
                
            } else if (!appState.currentGame.tooEarly) {
                // Cliqu√© trop t√¥t
                appState.currentGame.tooEarly = true;
                document.getElementById('reactionArea').style.background = '#e53e3e';
                document.getElementById('reactionArea').innerHTML = `
                    <div>
                        <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                        <div>TROP T√îT !</div>
                        <div style="font-size: 1.2rem; margin-top: 10px;">Attendez le signal vert !</div>
                    </div>
                `;
                
                setTimeout(() => {
                    showReactionInstructions();
                }, 2000);
            }
        }

        function cancelReactionRound() {
            showReactionInstructions();
        }

        function showReactionResults() {
            const avgTime = Math.round(appState.currentGame.reactionTimes.reduce((a, b) => a + b, 0) / appState.currentGame.reactionTimes.length);
            const bestTime = Math.min(...appState.currentGame.reactionTimes);
            
            let rating = '';
            if (avgTime < 250) rating = 'üèÜ NINJA - R√©flexes exceptionnels !';
            else if (avgTime < 350) rating = 'üéØ EXPERT - Excellents r√©flexes !';
            else if (avgTime < 450) rating = 'üëç BON - R√©flexes corrects !';
            else rating = 'üòÖ D√âBUTANT - Entra√Ænez-vous !';
            
            appState.gameData.totalScore += Math.max(1000 - avgTime, 100);
            appState.gameData.gamesPlayed++;
            
            document.getElementById('gameContent').innerHTML = `
                <div class="text-center">
                    <h3>üéâ Test de R√©flexes termin√© !</h3>
                    
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; border-radius: 20px; margin: 30px 0;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">${avgTime}ms</div>
                        <div style="font-size: 1.3rem; margin-bottom: 10px;">Temps moyen</div>
                        <div style="font-size: 1.1rem;">${rating}</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div style="background: #48bb78; color: white; padding: 20px; border-radius: 15px;">
                            <div style="font-size: 1.8rem; font-weight: bold;">${bestTime}ms</div>
                            <div>Meilleur temps</div>
                        </div>
                        <div style="background: #ed8936; color: white; padding: 20px; border-radius: 15px;">
                            <div style="font-size: 1.8rem; font-weight: bold;">${appState.currentGame.reactionTimes.length}</div>
                            <div>Rounds r√©ussis</div>
                        </div>
                    </div>
                    
                    <button class="btn" onclick="startReactionGame()">üîÑ Recommencer</button>
                </div>
            `;
            updateAllStats();
        }

        // Game Timer System
        function startGameTimer() {
            gameStartTime = Date.now();
            document.getElementById('gameTimer').style.display = 'block';
            
            gameTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function stopGameTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            document.getElementById('gameTimer').style.display = 'none';
        }

        function showGameArea() {
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('gameArea').scrollIntoView({ behavior: 'smooth' });
        }

        function closeGame() {
            document.getElementById('gameArea').style.display = 'none';
            stopGameTimer();
            
            // Nettoyer les timers de jeux sp√©cifiques
            if (appState.currentGame) {
                if (appState.currentGame.timer) clearInterval(appState.currentGame.timer);
                if (appState.currentGame.mathTimer) clearInterval(appState.currentGame.mathTimer);
                if (appState.currentGame.colorTimer) clearInterval(appState.currentGame.colorTimer);
            }
            
            appState.currentGame = null;
            showNotification('üö™ Jeu ferm√©', 'info');
        }

        // Video Conference System Enhanced
        async function startVideoCall() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 1280, height: 720 }, 
                    audio: true 
                });
                
                document.getElementById('localVideo').srcObject = localStream;
                
                document.getElementById('startCallBtn').style.display = 'none';
                document.getElementById('endCallBtn').style.display = 'inline-block';
                document.getElementById('callStatus').textContent = 'Appel en cours...';
                
                appState.videoCall.active = true;
                appState.videoCall.localStream = localStream;
                
                setTimeout(() => simulateParticipantJoin('Maman'), 2000);
                setTimeout(() => simulateParticipantJoin('Papa'), 4000);
                
                showNotification('üìπ Appel vid√©o d√©marr√© !', 'success');
                
            } catch (error) {
                console.error('Error starting video call:', error);
                handleVideoError(error);
            }
        }

        function handleVideoError(error) {
            let message = '‚ùå Erreur cam√©ra: ';
            
            switch(error.name) {
                case 'NotAllowedError':
                    message += 'Acc√®s refus√©. Autorisez la cam√©ra dans les param√®tres.';
                    break;
                case 'NotFoundError':
                    message += 'Aucune cam√©ra d√©tect√©e.';
                    break;
                case 'NotReadableError':
                    message += 'Cam√©ra utilis√©e par une autre application.';
                    break;
                default:
                    message += 'Probl√®me technique.';
            }
            
            showNotification(message, 'error');
        }

        function simulateParticipantJoin(memberName) {
            const videoGrid = document.getElementById('videoGrid');
            
            const videoItem = document.createElement('div');
            videoItem.className = 'video-item';
            videoItem.innerHTML = `
                <video autoplay></video>
                <div class="video-status">üë§ ${memberName}</div>
            `;
            
            // Simuler vid√©o avec canvas color√©
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 640;
            canvas.height = 480;
            
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            function drawFrame() {
                if (!appState.videoCall.active) return;
                
                ctx.fillStyle = color;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(memberName, canvas.width/2, canvas.height/2);
                
                requestAnimationFrame(drawFrame);
            }
            
            drawFrame();
            
            const stream = canvas.captureStream(30);
            videoItem.querySelector('video').srcObject = stream;
            
            videoGrid.appendChild(videoItem);
            
            appState.videoCall.participants.push({
                name: memberName,
                stream: stream,
                element: videoItem
            });
            
            updateParticipantsList();
            showNotification(`üëã ${memberName} a rejoint l'appel`, 'info');
        }

        function endVideoCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            const videoGrid = document.getElementById('videoGrid');
            const participantVideos = videoGrid.querySelectorAll('.video-item:not(#localVideoContainer)');
            participantVideos.forEach(video => video.remove());
            
            document.getElementById('localVideo').srcObject = null;
            
            document.getElementById('startCallBtn').style.display = 'inline-block';
            document.getElementById('endCallBtn').style.display = 'none';
            document.getElementById('callStatus').textContent = 'Pr√™t pour un appel';
            
            appState.videoCall.active = false;
            appState.videoCall.localStream = null;
            appState.videoCall.participants = [];
            
            updateParticipantsList();
            showNotification('üìû Appel termin√©', 'info');
        }

        function toggleMicrophone() {
            if (!localStream) return;
            
            const audioTrack = localStream.getAudioTracks()[0];
            if (audioTrack) {
                audioTrack.enabled = !audioTrack.enabled;
                appState.videoCall.micMuted = !audioTrack.enabled;
                
                const micBtn = document.getElementById('micBtn');
                micBtn.textContent = appState.videoCall.micMuted ? 'üîá' : 'üé§';
                micBtn.classList.toggle('active', appState.videoCall.micMuted);
                
                showNotification(appState.videoCall.micMuted ? 'üîá Micro coup√©' : 'üé§ Micro activ√©', 'info');
            }
        }

        function toggleCamera() {
            if (!localStream) return;
            
            const videoTrack = localStream.getVideoTracks()[0];
            if (videoTrack) {
                videoTrack.enabled = !videoTrack.enabled;
                appState.videoCall.videoMuted = !videoTrack.enabled;
                
                const cameraBtn = document.getElementById('cameraBtn');
                cameraBtn.textContent = appState.videoCall.videoMuted ? 'üì∑' : 'üìπ';
                cameraBtn.classList.toggle('active', appState.videoCall.videoMuted);
                
                showNotification(appState.videoCall.videoMuted ? 'üì∑ Cam√©ra d√©sactiv√©e' : 'üìπ Cam√©ra activ√©e', 'info');
            }
        }

        async function shareScreen() {
            try {
                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                
                const videoTrack = screenStream.getVideoTracks()[0];
                const localVideo = document.getElementById('localVideo');
                
                const originalStream = localVideo.srcObject;
                localVideo.srcObject = screenStream;
                
                videoTrack.addEventListener('ended', () => {
                    localVideo.srcObject = originalStream;
                    showNotification('üñ•Ô∏è Partage d\'√©cran arr√™t√©', 'info');
                });
                
                showNotification('üñ•Ô∏è Partage d\'√©cran d√©marr√©', 'success');
                
            } catch (error) {
                showNotification('‚ùå Partage d\'√©cran impossible', 'error');
            }
        }

        function updateParticipantsList() {
            const participantsText = appState.videoCall.participants.length > 0 
                ? `Participants: ${appState.videoCall.participants.map(p => p.name).join(', ')}`
                : 'En attente de participants';
            
            document.getElementById('participantsList').textContent = participantsText;
        }

        // Settings Management
        function loadSettings() {
            document.getElementById('settingsFamilyName').value = appState.familyInfo.name;
            document.getElementById('settingsMotto').value = appState.familyInfo.motto;
        }

        function saveSettings() {
            appState.familyInfo.name = document.getElementById('settingsFamilyName').value.trim() || 'Ma Famille';
            appState.familyInfo.motto = document.getElementById('settingsMotto').value.trim() || 'Ensemble, toujours plus forts !';
            
            updateAppTitle();
            saveAppData();
            showNotification('‚úÖ Param√®tres sauvegard√©s !', 'success');
        }

        // Enhanced Data Management (No localStorage)
        function saveAppData() {
            try {
                window.familleConnectSession = {
                    ...appState,
                    photos: appState.photos.map(photo => ({
                        ...photo,
                        src: photo.src.length > 100000 ? '[LARGE_IMAGE]' : photo.src
                    })),
                    lastSaved: new Date().toISOString()
                };
                
                updateSaveStatus('üíæ Session sauvegard√©e');
                
            } catch (error) {
                console.warn('Could not save session data:', error);
                updateSaveStatus('‚ö†Ô∏è Erreur sauvegarde');
            }
        }

        function loadAppData() {
            try {
                if (window.familleConnectSession) {
                    const loadedData = window.familleConnectSession;
                    
                    appState = {
                        ...appState,
                        ...loadedData,
                        videoCall: appState.videoCall
                    };
                    
                    // Convertir les timestamps
                    if (appState.messages) {
                        appState.messages = appState.messages.map(msg => ({
                            ...msg,
                            timestamp: new Date(msg.timestamp)
                        }));
                    }
                    
                    if (appState.photos) {
                        appState.photos = appState.photos.map(photo => ({
                            ...photo,
                            uploadDate: new Date(photo.uploadDate)
                        }));
                    }
                    
                    updateSaveStatus('‚úÖ Session restaur√©e');
                    return true;
                }
            } catch (error) {
                console.warn('Could not load session data:', error);
            }
            
            updateSaveStatus('üÜï Nouvelle session');
            return false;
        }

        function updateSaveStatus(message) {
            const statusDiv = document.getElementById('saveStatus');
            if (statusDiv) {
                statusDiv.textContent = message;
                statusDiv.style.opacity = '1';
                setTimeout(() => {
                    statusDiv.style.opacity = '0.7';
                }, 2000);
            }
        }

        function exportAllData() {
            const exportData = {
                ...appState,
                exportDate: new Date().toISOString(),
                version: '3.0.0',
                appName: 'Famille Connect Pro Enhanced'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `famille-connect-complet-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üíæ Sauvegarde compl√®te t√©l√©charg√©e !', 'success');
        }

        function importAllData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.familyInfo && importedData.members) {
                                appState = {
                                    ...appState,
                                    ...importedData,
                                    videoCall: appState.videoCall
                                };
                                
                                updateAppTitle();
                                renderFamilyMembers();
                                renderPhotoGallery();
                                renderChatMessages();
                                updateAllStats();
                                updateGameLevels();
                                
                                showNotification('‚úÖ Donn√©es import√©es avec succ√®s !', 'success');
                                saveAppData();
                            } else {
                                throw new Error('Format de fichier invalide');
                            }
                        } catch (error) {
                            showNotification('‚ùå Erreur lors de l\'import', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function resetApp() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir r√©initialiser compl√®tement l\'application ?')) {
                if (window.familleConnectSession) {
                    delete window.familleConnectSession;
                }
                location.reload();
            }
        }

        // Utility Functions
        function updateAppTitle() {
            document.getElementById('appTitle').textContent = `üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ${appState.familyInfo.name}`;
            document.getElementById('appSubtitle').textContent = appState.familyInfo.motto;
        }

        function updateAllStats() {
            // Stats principales
            document.getElementById('totalMembers').textContent = appState.members.length;
            document.getElementById('onlineNow').textContent = appState.members.filter(m => m.online).length;
            document.getElementById('totalMessages').textContent = appState.messages.length;
            document.getElementById('photosWithProfiles').textContent = appState.photos.length;
            
            // Stats de session dans param√®tres
            const sessionMembers = document.getElementById('sessionMembers');
            const sessionMessages = document.getElementById('sessionMessages');
            const sessionPhotos = document.getElementById('sessionPhotos');
            const gamesPlayed = document.getElementById('gamesPlayed');
            
            if (sessionMembers) sessionMembers.textContent = appState.members.length;
            if (sessionMessages) sessionMessages.textContent = appState.messages.length;
            if (sessionPhotos) sessionPhotos.textContent = appState.photos.length;
            if (gamesPlayed) gamesPlayed.textContent = appState.gameData.gamesPlayed || 0;
            
            // Chat en ligne
            const onlineCount = appState.members.filter(m => m.online).length;
            document.getElementById('onlineMembers').textContent = `üë• ${onlineCount} en ligne`;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.getElementById('notification');
            const colors = {
                success: '#48bb78',
                error: '#e53e3e',
                warning: '#ed8936',
                info: '#4299e1'
            };
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.innerHTML = `${icons[type] || ''} ${message}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function initializeApp() {
            if (appState.isConfigured) {
                document.getElementById('setupArea').classList.add('hidden');
                document.getElementById('mainApp').style.display = 'block';
                updateAppTitle();
                renderFamilyMembers();
                renderPhotoGallery();
            }
            
            updateConnectionStatus();
            
            // Message de bienvenue si pas de messages
            if (appState.messages.length === 0) {
                appState.messages.push({
                    id: 1,
                    sender: 'Syst√®me',
                    text: 'Bienvenue dans votre chat familial avec support photos ! üéâ',
                    timestamp: new Date(),
                    own: false
                });
            }
        }

        function updateConnectionStatus() {
            const status = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            if (navigator.onLine) {
                status.className = 'connection-status online show';
                text.textContent = 'üü¢ En ligne';
            } else {
                status.className = 'connection-status offline show';
                text.textContent = 'üî¥ Hors ligne';
            }
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // Event Listeners
        window.addEventListener('online', () => updateConnectionStatus());
        window.addEventListener('offline', () => updateConnectionStatus());

        // Auto-save en m√©moire toutes les 30 secondes
        setInterval(() => {
            if (appState.isConfigured) {
                saveAppData();
            }
        }, 30000);

        // Sauvegarder avant de quitter
        window.addEventListener('beforeunload', () => {
            saveAppData();
        });

        // Initialize first section
        window.addEventListener('load', () => {
            if (appState.isConfigured) {
                showSection('chat');
            }
        });

        // Raccourcis clavier
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                exportAllData();
            }
            
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.show');
                modals.forEach(modal => modal.classList.remove('show'));
                
                if (appState.currentGame) {
                    closeGame();
                }
            }
        });
    </script>
</body>
</html>
